<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Travel Agency Management System — Single File SPA</title>

  <!-- Poppins font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* ========== THEME (based on your provided style) ========== */
    :root{
      --bg:#f4f9ff;
      --primary1:#0077b6;
      --primary2:#00b4d8;
      --accent:#caf0f8;
      --card:#ffffff;
      --text:#1b1b1b;
      --muted:#444;
      --radius:10px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      font-family:'Poppins',sans-serif;
      margin:0;
      padding:0;
      background-color:var(--bg);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* header / nav */
    header{
      background:linear-gradient(90deg,var(--primary1),var(--primary2));
      color:#fff;
      padding:18px 20px;
      position:sticky;
      top:0;
      z-index:50;
      box-shadow:0 2px 8px rgba(3,26,43,0.06);
    }
    .wrap{
      max-width:1100px;
      margin:0 auto;
      display:flex;
      align-items:center;
      gap:20px;
      justify-content:space-between;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
    }
    .logo {
  width: 44px;
  height: 44px;
  border-radius: 8px;
  background:
    linear-gradient(135deg, rgba(255, 255, 255, 0.18), rgba(255, 255, 255, 0.06)),
    url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="white" viewBox="0 0 24 24"><path d="M21 16v-2l-8-5V3.5a1.5 1.5 0 0 0-3 0V9l-8 5v2l8-2.5V19l-2 1v1l3.5-0.5L15 21v-1l-2-1v-5.5L21 16z"/></svg>') center/60% no-repeat;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
}

    header h1{margin:0;font-size:1.05rem;font-weight:600;letter-spacing:0.2px}

    nav{
      display:flex;
      gap:12px;
      align-items:center;
    }
    nav a{
      color:white;
      text-decoration:none;
      padding:8px 12px;
      border-radius:8px;
      font-weight:500;
      transition:background .18s,color .18s,transform .12s;
    }
    nav a:hover{ color:var(--accent); transform:translateY(-2px); }
    nav a.active{
      background:rgba(255,255,255,0.08);
      box-shadow:inset 0 -2px 0 rgba(255,255,255,0.02);
    }

    /* page container */
    .container{
      max-width:1100px;
      margin:28px auto;
      padding:0 18px 80px;
    }

    .hero{
      background-image:url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&fit=crop&w=1600&q=80');
      background-size:cover;background-position:center;
      border-radius:12px;
      color:white;
      padding:48px 28px;
      box-shadow:0 8px 30px rgba(3,26,43,0.08);
      display:flex;
      gap:20px;
      align-items:center;
      justify-content:space-between;
    }
    .hero-left{max-width:640px}
    .hero h2{margin:0;font-size:2.05rem;line-height:1.02}
    .hero p{margin-top:10px;opacity:0.95}

    /* sections */
    .section{
      margin-top:28px;
      padding:24px;
      background:transparent;
    }
    h2.section-title{
      color:var(--primary1);
      font-size:1.6rem;
      margin:0 0 18px 0;
    }

    /* cards grid */
    .cards{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
      gap:18px;
    }
    .card{
      background:var(--card);
      border-radius:var(--radius);
      overflow:hidden;
      box-shadow:0 6px 18px rgba(3,26,43,0.06);
      transition:transform .22s,box-shadow .22s;
      cursor:pointer;
      display:flex;
      flex-direction:column;
    }
    .card:hover{ transform:translateY(-6px); box-shadow:0 14px 30px rgba(3,26,43,0.09); }
    .card img{width:100%;height:150px;object-fit:cover;display:block}
    .card .card-content{padding:14px;flex:1}
    .card .card-content h3{margin:0;color:var(--primary1);font-size:1.05rem}
    .card .card-content p{margin:8px 0 0;color:var(--muted);font-size:0.95rem}

    .btn{
      display:inline-block;
      background:linear-gradient(90deg,var(--primary1),var(--primary2));
      color:white;padding:10px 14px;border-radius:8px;text-decoration:none;font-weight:600;
      border:none;cursor:pointer;
      box-shadow:0 8px 18px rgba(0,0,0,0.08);
    }
    .btn.ghost{
      background:transparent;color:var(--primary1);border:1px solid rgba(0,119,182,0.12);
    }

    /* itinerary page specific */
    .itinerary-card{
      background:var(--card);
      border-radius:12px;
      padding:20px;
      box-shadow:0 8px 20px rgba(3,26,43,0.06);
      max-width:900px;margin:0 auto;
    }
    .itinerary-card h3{color:var(--primary1);margin:0 0 10px}

    .day-list{margin-top:14px;padding:0;list-style:none}
    .day-list li{
      background:linear-gradient(90deg, rgba(0,180,216,0.06), rgba(0,119,182,0.04));
      border-left:4px solid var(--primary1);
      padding:12px 14px;border-radius:8px;margin-bottom:10px;color:var(--text)
    }

    /* booking */
    .form{
      background:var(--card);
      padding:18px;border-radius:12px;
      max-width:480px;margin:0 auto;box-shadow:0 8px 20px rgba(3,26,43,0.06)
    }
    .form input, .form select{
      width:100%;padding:10px;border:1px solid rgba(0,119,182,0.12);
      border-radius:8px;margin-top:10px;font-size:0.98rem;
      outline:none;
    }
    .form button{margin-top:12px;width:100%}

    /* customer list */
    ul#customer-list{list-style:none;padding:0;margin-top:18px;max-width:480px;margin-left:auto;margin-right:auto}
    ul#customer-list li{
      background:white;padding:10px;border-radius:8px;border:1px solid rgba(0,180,216,0.12);
      margin-bottom:10px;color:var(--primary1);font-weight:600;
    }

    /* footer */
    footer{background:var(--primary1);color:white;padding:18px;text-align:center;margin-top:40px;border-radius:8px}

    /* small screens */
    @media (max-width:760px){
      .wrap{padding:0 12px}
      .hero{flex-direction:column;align-items:flex-start;padding:28px}
      .hero h2{font-size:1.45rem}
      nav{gap:8px;flex-wrap:wrap}
      header{padding:12px 10px}
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <header>
    <div class="wrap">
      <div class="brand">
        <div class="logo">  </div>
        <div>
          <h1>Travel Agency</h1>
          <div style="font-size:12px;opacity:0.95">Plan • Book • Explore</div>
        </div>
      </div>

      <nav id="main-nav">
        <!-- links are hash routes handled by JS -->
        <a href="#home" data-route="home" class="nav-link active">Home</a>
        <a href="#tours" data-route="tours" class="nav-link">Tours</a>
        <a href="#flights" data-route="flights" class="nav-link">Flights</a>
        <a href="#hotels" data-route="hotels" class="nav-link">Hotels</a>
        <a href="#booking" data-route="booking" class="nav-link">Booking</a>
      </nav>
    </div>
  </header>

  <!-- APP CONTAINER -->
  <div class="container" id="app">

    <!-- Pages are rendered into this element by JS -->
    <!-- Default content is in JS router -->
  </div>

  <footer>
    &copy; <span id="year"></span> Travel Agency Management System
  </footer>

  <script>
    /* ===================== DATA ===================== */
    const TOUR_DATA = [
      {
        id: "paris-getaway",
        name: "Paris Getaway",
        short: "5 days exploring the City of Lights — Eiffel, Louvre & Seine.",
        image: "https://source.unsplash.com/800x600/?paris,eiffel",
        price: "₹1,20,000",
        details: {
          description: "A romantic classic: art, food and iconic landmarks.",
          days: [
            "Arrival, Seine walk and Eiffel Tower by evening",
            "Louvre museum + Montmartre evening",
            "Versailles day trip",
            "Shopping day + local markets",
            "Departure"
          ]
        }
      },
      {
        id: "bali-bliss",
        name: "Bali Bliss",
        short: "Relax on pristine beaches, cultural Ubud & rice terraces.",
        image: "https://source.unsplash.com/800x600/?bali,beach",
        price: "₹85,000",
        details: {
          description: "Beaches, temples and yoga — perfect for rest & recharge.",
          days: [
            "Arrival and beach relaxation",
            "Ubud: monkey forest & rice terraces",
            "Water sports + beach club",
            "Island tour and sunset temple",
            "Departure"
          ]
        }
      },
      {
        id: "swiss-escape",
        name: "Swiss Escape",
        short: "Snowy alps, scenic trains and lakeside towns.",
        image: "https://source.unsplash.com/800x600/?switzerland,alps",
        price: "₹1,40,000",
        details: {
          description: "Scenic rail journeys, alpine hikes and cozy villages.",
          days: [
            "Zurich arrival + lakeside walk",
            "Interlaken & Jungfrau excursion",
            "Lucerne and Mount Pilatus",
            "Scenic train rides",
            "Departure"
          ]
        }
      }
    ];

    /* ================ UTILITIES ================ */
    function el(id){ return document.getElementById(id); }
    function updateYear(){ el('year').textContent = new Date().getFullYear(); }
    updateYear();

    function setActiveNav(route){
      document.querySelectorAll('.nav-link').forEach(a=>{
        if(a.dataset.route === route) a.classList.add('active'); else a.classList.remove('active');
      });
    }

    function parseHash(){
      // examples: "#itinerary?id=paris-getaway" or "#tours" or "#home"
      const raw = location.hash.slice(1) || 'home';
      const [routePart, queryPart] = raw.split('?');
      const params = {};
      if(queryPart){
        queryPart.split('&').forEach(p=>{
          const [k,v] = p.split('=');
          if(k) params[k] = decodeURIComponent(v || '');
        });
      }
      return { route: routePart, params };
    }

    /* ================ RENDERERS ================ */
    function renderHome(){
      setActiveNav('home');
      return `
        <section class="hero" role="banner">
          <div class="hero-left">
            <h2>Explore the world with us</h2>
            <p>Handpicked packages, easy bookings and friendly support. Choose a destination below to view full itinerary and package details.</p>
            <div style="margin-top:18px;">
              <a class="btn" href="#tours">Explore Tours</a>
            </div>
          </div>
          <div style="max-width:360px;">
            <img src="https://source.unsplash.com/520x360/?travel,adventure" alt="travel" style="width:100%;border-radius:10px;box-shadow:0 8px 24px rgba(3,26,43,0.08)">
          </div>
        </section>

        <section class="section">
          <h2 class="section-title">Popular Tours</h2>
          <div class="cards">
            ${TOUR_DATA.map(t => tourCardHtml(t)).join('')}
          </div>
        </section>
      `;
    }

    function renderTours(){
      setActiveNav('tours');
      return `
        <section class="section">
          <h2 class="section-title">All Tour Packages</h2>
          <p style="max-width:800px;margin:0 auto 18px;color:var(--muted)">Click any package to view full itinerary and book.</p>
          <div class="cards">
            ${TOUR_DATA.map(t => tourCardHtml(t, true)).join('')}
          </div>
        </section>
      `;
    }

    function tourCardHtml(t, showPrice=false){
      return `
        <article class="card" role="button" onclick="openItinerary('${t.id}')">
          <img src="${t.image}" alt="${t.name}">
          <div class="card-content">
            <h3>${t.name}</h3>
            <p>${t.short}</p>
            ${showPrice ? `<p style="margin-top:10px;font-weight:700;color:var(--primary1)">${t.price}</p>` : ''}
          </div>
        </article>
      `;
    }

    function renderItinerary(id){
      setActiveNav('tours'); // itinerary is from tours category
      const t = TOUR_DATA.find(x => x.id === id);
      if(!t) return `<section class="section"><h2 class="section-title">Tour not found</h2><p>We couldn't find that tour. <a href="#tours" class="btn ghost">Back to tours</a></p></section>`;
      return `
        <section class="section">
          <div style="display:flex;gap:18px;flex-wrap:wrap;align-items:flex-start;justify-content:center">
            <div style="flex:1;min-width:300px;max-width:520px">
              <img src="${t.image}" alt="${t.name}" style="width:100%;border-radius:12px;box-shadow:0 8px 20px rgba(3,26,43,0.06)">
            </div>

            <div style="flex:1;min-width:280px;max-width:480px">
              <div class="itinerary-card">
                <h3>${t.name}</h3>
                <p style="margin:8px 0 10px;color:var(--muted)">${t.details.description}</p>
                <p style="font-weight:700;color:var(--primary1)">${t.price}</p>
                <h4 style="margin-top:14px;margin-bottom:8px">Itinerary</h4>
                <ul class="day-list">
                  ${t.details.days.map((d,i)=>`<li><strong>Day ${i+1}:</strong> ${d}</li>`).join('')}
                </ul>

                <div style="margin-top:16px;display:flex;gap:10px">
                  <button class="btn" onclick="startBooking('${t.id}')">Book this package</button>
                  <a href="#tours" class="btn ghost" style="align-self:center">Back to Tours</a>
                </div>
              </div>
            </div>
          </div>
        </section>
      `;
    }

    function renderFlights(){
      setActiveNav('flights');
      return `
        <section class="section">
          <h2 class="section-title">Available Flights</h2>
          <p style="color:var(--muted)">Flight search & integration coming soon. For now, you can view packages and book customers below.</p>
        </section>
      `;
    }

    function renderHotels(){
      setActiveNav('hotels');
      return `
        <section class="section">
          <h2 class="section-title">Hotels & Accommodations</h2>
          <p style="color:var(--muted)">Hotel listings coming soon. We'll integrate hotel suggestions to match packages.</p>
        </section>
      `;
    }

    /* booking page */
    function renderBooking(prefill){
      setActiveNav('booking');
      return `
        <section class="section">
          <h2 class="section-title">Customer Booking</h2>

          <div class="form" role="form">
            <label style="font-weight:600">Name</label>
            <input id="bk-name" type="text" placeholder="Full name" required>

            <label style="font-weight:600;margin-top:8px">Email</label>
            <input id="bk-email" type="email" placeholder="you@example.com" required>

            <label style="font-weight:600;margin-top:8px">Phone</label>
            <input id="bk-phone" type="text" placeholder="+91..." required>

            <label style="font-weight:600;margin-top:8px">Package</label>
            <select id="bk-package">
              <option value="">-- choose package --</option>
              ${TOUR_DATA.map(t => `<option value="${t.id}" ${prefill===t.id ? 'selected':''}>${t.name} — ${t.price}</option>`).join('')}
            </select>

            <button class="btn" id="bk-submit">Add Customer</button>
          </div>

          <ul id="customer-list"></ul>
        </section>
      `;
    }

    /* ================ APP / ROUTER ================ */
    const app = el('app');

    function routerRender(){
      const {route, params} = parseHash();
      // route handler
      if(route === 'home' || route === ''){
        app.innerHTML = renderHome();
      } else if(route === 'tours'){
        app.innerHTML = renderTours();
      } else if(route === 'itinerary'){
        // expects params.id
        app.innerHTML = renderItinerary(params.id);
      } else if(route === 'flights'){
        app.innerHTML = renderFlights();
      } else if(route === 'hotels'){
        app.innerHTML = renderHotels();
      } else if(route === 'booking'){
        app.innerHTML = renderBooking(params.prefill);
      } else {
        // fallback
        app.innerHTML = `<section class="section"><h2 class="section-title">Page not found</h2><p><a href="#home" class="btn">Go home</a></p></section>`;
      }

      // after render tasks (attach event listeners)
      attachAfterRender();
    }

    /* called after new page is rendered */
    function attachAfterRender(){
      // booking form submit
      const bkBtn = document.getElementById('bk-submit');
      if(bkBtn){
        bkBtn.addEventListener('click', (e)=>{
          e.preventDefault();
          const name = document.getElementById('bk-name').value.trim();
          const email = document.getElementById('bk-email').value.trim();
          const phone = document.getElementById('bk-phone').value.trim();
          const pkg = document.getElementById('bk-package').value;

          if(!name || !email || !phone || !pkg){
            // Use the new renderCustomerList to show form errors
            renderCustomerList(null, "Please fill all fields and choose a package.");
            return;
          }

          addCustomer({name,email,phone,pkg});
          
          // Clear form after submission
          document.getElementById('bk-name').value='';
          document.getElementById('bk-email').value='';
          document.getElementById('bk-phone').value='';
          document.getElementById('bk-package').value='';
        });
      }

      // render customer list from storage
      renderCustomerList();
    }

   /* ================ CUSTOMER HANDLING (UPDATED) ================ */

    // This version sends data to your Node.js/MongoDB backend
    // and displays status messages instead of alerts.

    async function addCustomer(bookingData) {
      const listEl = document.getElementById("customer-list");
      if (!listEl) return;
      
      // 1. Show a loading message
      listEl.innerHTML = `<li style="color:var(--muted)">Sending booking...</li>`;

      try {
        // 2. This is your backend server URL
        const backendUrl = "http://localhost:3000/api/bookings";

        const res = await fetch(backendUrl, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(bookingData)
        });

        // 3. Handle success or error from the server
        if (!res.ok) {
          const errData = await res.json();
          throw new Error(errData.message || "Failed to save booking");
        }

        const savedBooking = await res.json();
        
        // 4. Show success message
        renderCustomerList(savedBooking, null);

      } catch (err) {
        console.error("Error sending to backend:", err);
        // 5. Show error message
        renderCustomerList(null, "Could not connect to server. Is it running?");
      }
    }

    function renderCustomerList(booking, error) {
      const listEl = document.getElementById("customer-list");
      if (!listEl) return;
      
      if (error) {
        // Show an error message
        listEl.innerHTML = `<li style="color:red;font-weight:600;background:#fff0f0;">Error: ${error}</li>`;
      } else if (booking) {
        // Show a success message
        listEl.innerHTML = `<li style="color:green;font-weight:600;background:#f0fff0;">Success! Booking for ${booking.name} received.</li>`;
      } else {
        // Show the default empty state
        listEl.innerHTML = `
          <p style="color:var(--muted);text-align:center;">
            Submit a booking to see its status here.
          </p>`;
      }
    }


    /* ================ NAV ACTIONS ================ */
    window.openItinerary = function(id){
      // navigate to itinerary with id param
      location.hash = `itinerary?id=${encodeURIComponent(id)}`;
    };

    window.startBooking = function(id){
      // go to booking page with prefill
      location.hash = `booking?prefill=${encodeURIComponent(id)}`;
    };

    // handle navigation when clicking nav anchors: ensure active class update
    document.querySelectorAll('.nav-link').forEach(a=>{
      a.addEventListener('click', (e)=>{
        // active class managed in routerRender via setActiveNav
        // allow hash to change and then let router handle it
      });
    });

    /* initial render + hash change listener */
    window.addEventListener('hashchange', routerRender);
    window.addEventListener('load', ()=>{
      if(!location.hash) location.hash = '#home';
      routerRender();
    });

    // keyboard: support left/right to cycle tours (small nicety)
    window.addEventListener('keydown', e=>{
      if(e.key === 'Escape') location.hash = '#home';
    });

  </script>
</body>
</html>